<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <title>ESEO Apply</title>
</head>
<body>

    <header>
        <div  onclick="openJavaWindow()">
            <img src="https://cdn-icons-png.flaticon.com/512/8727/8727966.png" alt="Profile Picture" class="profile-pic">
            <span class="username">S'inscrire</span>
        </div>
    </header>

    <h1>Job Board</h1>
    <nav>
        <a href="#job-list">Liste des Offres</a>
        <a href="#application-tracker">Suivi des Candidatures</a>
    </nav>

    <a href="recapitulatif.html" class="recap-button">Voir mon r√©capitulatif</a>

    <h1>Jobs</h1>
    <div class="container">
        <!-- Carte d'offre d'emploi 1 -->
        <a href="Offre1.html">
            <div class="job-card">
                <img src="Thales.png" alt="Job Image">
                <div class="job-card-content">
                    <p class="company-name">THALES</p>
                    <p class="job-title">
                        Data Engineer (F/H)
                    </p>
                    <p class="location">üìç V√©lizy-Villacoublay</p>
                    <p class="job-meta">Alternance ¬∑ il y a 16 heures</p>
                    <button class="toggle-application" data-job-id="1">consulter</button>
                </div>
            </div>
        </a>

        <!-- Carte d'offre d'emploi 2 -->
         <a href="Offre2.html">
            <div class="job-card">
                <img src="Thales.png" alt="Job Image">
                <div class="job-card-content">
                    <p class="company-name">THALES</p>
                    <p class="job-title">
                        Ing√©nieur data Spark (F/H)
                    </p>
                    <p class="location">üìç V√©lizy-Villacoublay</p>
                    <p class="job-meta">Stage ¬∑ il y a 16 heures</p>
                    <button class="toggle-application" data-job-id="1">consulter</button>
                </div>
            </div>
         </a>

        <!-- Carte d'offre d'emploi 3 -->
         <a href="Offre3.html">
            <div class="job-card">
                <img src="Thales.png" alt="Job Image">
                <div class="job-card-content">
                    <p class="company-name">THALES</p>
                    <p class="job-title">
                         Data Engineer (F/H)
                    </p>
                    <p class="location">üìç V√©lizy-Villacoublay</p>
                    <p class="job-meta">Stage ¬∑ il y a 16 heures</p>
                    <button class="toggle-application" data-job-id="1">consulter</button>
                </div>
            </div>
         </a>
        
    </div>

     <!-- Section Application Tracker -->
     <section id="application-tracker">
        <ul id="application-history">
            <!-- Historique des candidatures sera rempli par JavaScript -->
        </ul>
    </section>

    <footer>
        <i class="bi bi-instagram"></i>       
        <p align="center">&copy; 2024 Mini Job Board</p>
    </footer>

    <script>
        async function openJavaWindow() {
            try {
                const response = await fetch('http://localhost:8080/open-window', {
                    method: 'POST'
                });

                if (response.ok) {
                    alert("Fen√™tre Java ouverte !");
                } else {
                    alert("Erreur lors de l'ouverture de la fen√™tre Java.");
                }
            } catch (error) {
                console.error("Erreur :", error);
                alert("Impossible de contacter le serveur.");
            }
        }
    </script>

    <script>
        // Envoyer les donn√©es au back-end Java
        document.getElementById('signupForm').addEventListener('submit', function(e) {
            e.preventDefault(); // Emp√™che le rechargement de la page

            const formData = {
                nom: document.getElementById('nom').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value
            };

            fetch('http://localhost:8080/api/users', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => alert('Compte cr√©√© avec succ√®s !'))
            .catch(error => alert('Erreur lors de la cr√©ation du compte.'));
        });
    </script>

    <script>
        // Gestionnaire de candidatures
        const applications = {}; // Objet pour suivre l'√©tat des candidatures

        // Gestion du clic sur le bouton "postul√©e"
        document.querySelectorAll('.toggle-application').forEach(button => {
            button.addEventListener('click', () => {
                const jobId = button.dataset.jobId;
                const jobCard = button.closest('.job-card');
                const jobTitle = jobCard.querySelector('h3').innerText;

                // Basculer entre "postul√©e" et "non postul√©e"
                if (!applications[jobId]) {
                    applications[jobId] = { jobTitle, status: 'postul√©e', date: new Date().toLocaleString() };
                    button.textContent = 'Marquer comme non postul√©e';
                } else {
                    delete applications[jobId];
                    button.textContent = 'Marquer comme postul√©e';
                }

                updateApplicationHistory();
            });
        });

        // Mettre √† jour l'historique des candidatures
        function updateApplicationHistory() {
            const historyList = document.getElementById('application-history');
            historyList.innerHTML = '';

            Object.values(applications).forEach(application => {
                const listItem = document.createElement('li');
                listItem.textContent = `${application.jobTitle} - ${application.status} le ${application.date}`;
                historyList.appendChild(listItem);
            });
        }
    </script>
</body>
</html>
